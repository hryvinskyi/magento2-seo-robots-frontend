<?xml version="1.0" encoding="UTF-8"?>
<!--
 /**
  * Copyright (c) 2026. Volodymyr Hryvinskyi. All rights reserved.
  * Author: Volodymyr Hryvinskyi <volodymyr@hryvinskyi.com>
  * GitHub: https://github.com/hryvinskyi
  */
-->
<tests xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:noNamespaceSchemaLocation="urn:magento:mftf:Test/etc/testSchema.xsd">
    <test name="StorefrontSeoRobotsPaginatedPageTest">
        <annotations>
            <features value="SeoRobotsFrontend"/>
            <stories value="SEO Robots on Paginated Pages"/>
            <title value="Verify paginated pages have correct robots meta tag"/>
            <description value="Verify that paginated category pages (page 2+) display the configured robots meta tag when pagination robots is enabled"/>
            <severity value="MAJOR"/>
            <group value="seo"/>
            <group value="seo_robots"/>
            <group value="seo_robots_frontend"/>
        </annotations>

        <before>
            <actionGroup ref="AdminLoginActionGroup" stepKey="loginAsAdmin"/>
            <!-- Navigate to SEO Robots configuration and enable -->
            <actionGroup ref="AdminNavigateToSeoRobotsConfigActionGroup" stepKey="navigateToConfig"/>
            <actionGroup ref="AdminExpandSeoRobotsSectionActionGroup" stepKey="expandSection"/>
            <actionGroup ref="AdminSetSeoRobotsEnabledActionGroup" stepKey="enableSeoRobots">
                <argument name="enabled" value="1"/>
            </actionGroup>
            <actionGroup ref="AdminSetPaginatedRobotsActionGroup" stepKey="enablePaginatedRobots">
                <argument name="enabled" value="1"/>
            </actionGroup>
            <actionGroup ref="AdminConfigurationSetInheritActionGroup" stepKey="setInheritValue">
                <argument name="rowId" value="{{AdminSeoRobotsConfigSection.paginatedRobotsTypeRow}}"/>
            </actionGroup>
            <actionGroup ref="AdminSaveSeoRobotsConfigActionGroup" stepKey="saveConfig"/>

            <magentoCLI stepKey="setFlatCatalogCategory" command="config:set catalog/frontend/flat_catalog_category 1 "/>
            <magentoCLI stepKey="setFlatCatalogProduct" command="config:set catalog/frontend/flat_catalog_product 1 "/>
            <createData entity="_defaultCategory" stepKey="createDefaultCategory"/>
            <createData entity="_defaultProduct" stepKey="simpleProduct1">
                <requiredEntity createDataKey="createDefaultCategory"/>
            </createData>
            <createData entity="_defaultProduct" stepKey="simpleProduct2">
                <requiredEntity createDataKey="createDefaultCategory"/>
            </createData>
            <createData entity="_defaultProduct" stepKey="simpleProduct3">
                <requiredEntity createDataKey="createDefaultCategory"/>
            </createData>
            <createData entity="_defaultProduct" stepKey="simpleProduct4">
                <requiredEntity createDataKey="createDefaultCategory"/>
            </createData>
            <createData entity="_defaultProduct" stepKey="simpleProduct5">
                <requiredEntity createDataKey="createDefaultCategory"/>
            </createData>
            <createData entity="_defaultProduct" stepKey="simpleProduct6">
                <requiredEntity createDataKey="createDefaultCategory"/>
            </createData>
            <createData entity="_defaultProduct" stepKey="simpleProduct7">
                <requiredEntity createDataKey="createDefaultCategory"/>
            </createData>
            <createData entity="_defaultProduct" stepKey="simpleProduct8">
                <requiredEntity createDataKey="createDefaultCategory"/>
            </createData>
            <createData entity="_defaultProduct" stepKey="simpleProduct9">
                <requiredEntity createDataKey="createDefaultCategory"/>
            </createData>
            <createData entity="_defaultProduct" stepKey="simpleProduct10">
                <requiredEntity createDataKey="createDefaultCategory"/>
            </createData>
            <createData entity="_defaultProduct" stepKey="simpleProduct11">
                <requiredEntity createDataKey="createDefaultCategory"/>
            </createData>
            <createData entity="_defaultProduct" stepKey="simpleProduct12">
                <requiredEntity createDataKey="createDefaultCategory"/>
            </createData>
            <createData entity="_defaultProduct" stepKey="simpleProduct13">
                <requiredEntity createDataKey="createDefaultCategory"/>
            </createData>
            <createData entity="_defaultProduct" stepKey="simpleProduct14">
                <requiredEntity createDataKey="createDefaultCategory"/>
            </createData>
            <createData entity="_defaultProduct" stepKey="simpleProduct15">
                <requiredEntity createDataKey="createDefaultCategory"/>
            </createData>
            <createData entity="_defaultProduct" stepKey="simpleProduct16">
                <requiredEntity createDataKey="createDefaultCategory"/>
            </createData>
            <createData entity="_defaultProduct" stepKey="simpleProduct17">
                <requiredEntity createDataKey="createDefaultCategory"/>
            </createData>
            <createData entity="_defaultProduct" stepKey="simpleProduct18">
                <requiredEntity createDataKey="createDefaultCategory"/>
            </createData>
            <createData entity="_defaultProduct" stepKey="simpleProduct19">
                <requiredEntity createDataKey="createDefaultCategory"/>
            </createData>
            <createData entity="_defaultProduct" stepKey="simpleProduct20">
                <requiredEntity createDataKey="createDefaultCategory"/>
            </createData>
            <createData entity="_defaultProduct" stepKey="simpleProduct21">
                <requiredEntity createDataKey="createDefaultCategory"/>
            </createData>
            <createData entity="_defaultProduct" stepKey="simpleProduct22">
                <requiredEntity createDataKey="createDefaultCategory"/>
            </createData>
            <createData entity="_defaultProduct" stepKey="simpleProduct23">
                <requiredEntity createDataKey="createDefaultCategory"/>
            </createData>
            <createData entity="_defaultProduct" stepKey="simpleProduct24">
                <requiredEntity createDataKey="createDefaultCategory"/>
            </createData>
            <createData entity="_defaultProduct" stepKey="simpleProduct25">
                <requiredEntity createDataKey="createDefaultCategory"/>
            </createData>
            <createData entity="_defaultProduct" stepKey="simpleProduct26">
                <requiredEntity createDataKey="createDefaultCategory"/>
            </createData>
            <createData entity="_defaultProduct" stepKey="simpleProduct27">
                <requiredEntity createDataKey="createDefaultCategory"/>
            </createData>
            <createData entity="_defaultProduct" stepKey="simpleProduct28">
                <requiredEntity createDataKey="createDefaultCategory"/>
            </createData>
            <createData entity="_defaultProduct" stepKey="simpleProduct29">
                <requiredEntity createDataKey="createDefaultCategory"/>
            </createData>
            <createData entity="_defaultProduct" stepKey="simpleProduct30">
                <requiredEntity createDataKey="createDefaultCategory"/>
            </createData>
            <!-- Reindex invalidated indices after products has been created/deleted -->
            <actionGroup ref="CliIndexerReindexActionGroup" stepKey="reindexInvalidatedIndices">
                <argument name="indices" value=""/>
            </actionGroup>

            <actionGroup ref="CliCacheFlushActionGroup" stepKey="flushCache">
                <argument name="tags" value=""/>
            </actionGroup>
        </before>
        <after>
            <magentoCLI stepKey="setFlatCatalogCategory" command="config:set catalog/frontend/flat_catalog_category 0" />
            <magentoCLI stepKey="setFlatCatalogProduct" command="config:set catalog/frontend/flat_catalog_product 0" />
            <deleteData createDataKey="createDefaultCategory" stepKey="deleteCategory"/>
            <deleteData createDataKey="simpleProduct1" stepKey="deleteSimpleProduct1"/>
            <deleteData createDataKey="simpleProduct2" stepKey="deleteSimpleProduct2"/>
            <deleteData createDataKey="simpleProduct3" stepKey="deleteSimpleProduct3"/>
            <deleteData createDataKey="simpleProduct4" stepKey="deleteSimpleProduct4"/>
            <deleteData createDataKey="simpleProduct5" stepKey="deleteSimpleProduct5"/>
            <deleteData createDataKey="simpleProduct6" stepKey="deleteSimpleProduct6"/>
            <deleteData createDataKey="simpleProduct7" stepKey="deleteSimpleProduct7"/>
            <deleteData createDataKey="simpleProduct8" stepKey="deleteSimpleProduct8"/>
            <deleteData createDataKey="simpleProduct9" stepKey="deleteSimpleProduct9"/>
            <deleteData createDataKey="simpleProduct10" stepKey="deleteSimpleProduct10"/>
            <deleteData createDataKey="simpleProduct11" stepKey="deleteSimpleProduct11"/>
            <deleteData createDataKey="simpleProduct12" stepKey="deleteSimpleProduct12"/>
            <deleteData createDataKey="simpleProduct13" stepKey="deleteSimpleProduct13"/>
            <deleteData createDataKey="simpleProduct14" stepKey="deleteSimpleProduct14"/>
            <deleteData createDataKey="simpleProduct15" stepKey="deleteSimpleProduct15"/>
            <deleteData createDataKey="simpleProduct16" stepKey="deleteSimpleProduct16"/>
            <deleteData createDataKey="simpleProduct17" stepKey="deleteSimpleProduct17"/>
            <deleteData createDataKey="simpleProduct18" stepKey="deleteSimpleProduct18"/>
            <deleteData createDataKey="simpleProduct19" stepKey="deleteSimpleProduct19"/>
            <deleteData createDataKey="simpleProduct20" stepKey="deleteSimpleProduct20"/>
            <deleteData createDataKey="simpleProduct21" stepKey="deleteSimpleProduct21"/>
            <deleteData createDataKey="simpleProduct22" stepKey="deleteSimpleProduct22"/>
            <deleteData createDataKey="simpleProduct23" stepKey="deleteSimpleProduct23"/>
            <deleteData createDataKey="simpleProduct24" stepKey="deleteSimpleProduct24"/>
            <deleteData createDataKey="simpleProduct25" stepKey="deleteSimpleProduct25"/>
            <deleteData createDataKey="simpleProduct26" stepKey="deleteSimpleProduct26"/>
            <deleteData createDataKey="simpleProduct27" stepKey="deleteSimpleProduct27"/>
            <deleteData createDataKey="simpleProduct28" stepKey="deleteSimpleProduct28"/>
            <deleteData createDataKey="simpleProduct29" stepKey="deleteSimpleProduct29"/>
            <deleteData createDataKey="simpleProduct30" stepKey="deleteSimpleProduct30"/>
            <actionGroup ref="AdminLogoutActionGroup" stepKey="logout"/>
        </after>

        <!-- ============================================== -->
        <!-- TEST 1: Default configuration (index, follow) -->
        <!-- ============================================== -->

        <!-- Navigate to page 2 of a category using query parameter -->
        <amOnPage url="{{StorefrontCategoryPage.url($$createDefaultCategory.custom_attributes[url_key]$$)}}?p=2" stepKey="goToPaginatedPage"/>
        <waitForPageLoad stepKey="waitForPageLoad"/>

        <!-- Verify meta robots tag contains index -->
        <actionGroup ref="StorefrontAssertMetaRobotsActionGroup" stepKey="verifyPaginatedMetaRobotsIndex">
            <argument name="expectedRobots" value="index"/>
        </actionGroup>

        <!-- Verify meta robots tag contains follow -->
        <actionGroup ref="StorefrontAssertMetaRobotsActionGroup" stepKey="verifyPaginatedMetaRobotsFollow">
            <argument name="expectedRobots" value="follow"/>
        </actionGroup>

        <!-- ============================================== -->
        <!-- TEST 2: Change to noindex, nofollow configuration -->
        <!-- ============================================== -->

        <!-- Navigate to admin and change paginated robots to noindex, nofollow -->
        <actionGroup ref="AdminNavigateToSeoRobotsConfigActionGroup" stepKey="navigateToConfigTest2"/>
        <actionGroup ref="AdminExpandSeoRobotsSectionActionGroup" stepKey="expandSectionTest2"/>
        <actionGroup ref="AdminConfigurationSetDirectiveActionGroup" stepKey="setNoIndexTest2">
            <argument name="rowId" value="{{AdminSeoRobotsConfigSection.paginatedRobotsTypeRow}}"/>
            <argument name="directive" value="noindex"/>
        </actionGroup>
        <actionGroup ref="AdminConfigurationSetDirectiveActionGroup" stepKey="setNoFollowTest2">
            <argument name="rowId" value="{{AdminSeoRobotsConfigSection.paginatedRobotsTypeRow}}"/>
            <argument name="directive" value="nofollow"/>
        </actionGroup>
        <actionGroup ref="AdminSaveSeoRobotsConfigActionGroup" stepKey="saveConfigTest2"/>
        <actionGroup ref="CliCacheFlushActionGroup" stepKey="flushCacheTest2">
            <argument name="tags" value=""/>
        </actionGroup>

        <!-- Navigate to page 2 and verify noindex, nofollow -->
        <amOnPage url="{{StorefrontCategoryPage.url($$createDefaultCategory.custom_attributes[url_key]$$)}}?p=2" stepKey="goToPaginatedPageTest2"/>
        <waitForPageLoad stepKey="waitForPageLoadTest2"/>

        <!-- Verify meta robots tag contains noindex -->
        <actionGroup ref="StorefrontAssertMetaRobotsActionGroup" stepKey="verifyPaginatedMetaRobotsNoIndex">
            <argument name="expectedRobots" value="noindex"/>
        </actionGroup>

        <!-- Verify meta robots tag contains nofollow -->
        <actionGroup ref="StorefrontAssertMetaRobotsActionGroup" stepKey="verifyPaginatedMetaRobotsNoFollow">
            <argument name="expectedRobots" value="nofollow"/>
        </actionGroup>

        <!-- ============================================== -->
        <!-- TEST 3: Change to all only configuration -->
        <!-- ============================================== -->

        <!-- Navigate to admin and change paginated robots to all only -->
        <actionGroup ref="AdminNavigateToSeoRobotsConfigActionGroup" stepKey="navigateToConfigTest3"/>
        <actionGroup ref="AdminExpandSeoRobotsSectionActionGroup" stepKey="expandSectionTest3"/>
        <actionGroup ref="AdminConfigurationSetDirectiveActionGroup" stepKey="setAllOnly">
            <argument name="rowId" value="{{AdminSeoRobotsConfigSection.paginatedRobotsTypeRow}}"/>
            <argument name="directive" value="all"/>
        </actionGroup>
        <actionGroup ref="AdminSaveSeoRobotsConfigActionGroup" stepKey="saveConfigTest3"/>
        <actionGroup ref="CliCacheFlushActionGroup" stepKey="flushCacheTest3">
            <argument name="tags" value=""/>
        </actionGroup>

        <!-- Navigate to page 2 and verify all only -->
        <amOnPage url="{{StorefrontCategoryPage.url($$createDefaultCategory.custom_attributes[url_key]$$)}}?p=2" stepKey="goToPaginatedPageTest3"/>
        <waitForPageLoad stepKey="waitForPageLoadTest3"/>

        <!-- Verify meta robots tag contains all -->
        <actionGroup ref="StorefrontAssertMetaRobotsActionGroup" stepKey="verifyPaginatedMetaRobotsAllOnly">
            <argument name="expectedRobots" value="all"/>
        </actionGroup>

        <!-- ============================================== -->
        <!-- TEST 4: Disable Paginated Robots -->
        <!-- ============================================== -->

        <!-- Disable Paginated Robots -->
        <actionGroup ref="AdminNavigateToSeoRobotsConfigActionGroup" stepKey="navigateToConfigDisable"/>
        <actionGroup ref="AdminExpandSeoRobotsSectionActionGroup" stepKey="expandSectionDisable"/>
        <actionGroup ref="AdminSetSeoRobotsEnabledActionGroup" stepKey="disableSeoRobots4">
            <argument name="enabled" value="1"/>
        </actionGroup>
        <actionGroup ref="AdminConfigurationUnsetInheritActionGroup" stepKey="unsetInheritActionGroup">
            <argument name="rowId" value="{{AdminSeoRobotsConfigSection.paginatedRobotsTypeRow}}"/>
        </actionGroup>
        <actionGroup ref="AdminConfigurationSetDirectiveActionGroup" stepKey="setAllOnly4">
            <argument name="rowId" value="{{AdminSeoRobotsConfigSection.paginatedRobotsTypeRow}}"/>
            <argument name="directive" value="all"/>
        </actionGroup>
        <actionGroup ref="AdminSaveSeoRobotsConfigActionGroup" stepKey="saveConfigDisable1"/>
        <actionGroup ref="AdminSetPaginatedRobotsActionGroup" stepKey="disablePaginatedRobots">
            <argument name="enabled" value="0"/>
        </actionGroup>
        <actionGroup ref="AdminSaveSeoRobotsConfigActionGroup" stepKey="saveConfigDisable2"/>
        <actionGroup ref="CliCacheFlushActionGroup" stepKey="flushCacheDisable">
            <argument name="tags" value=""/>
        </actionGroup>

        <!-- Navigate to page 2 and verify INDEX,FOLLOW meta tag -->
        <amOnPage url="{{StorefrontCategoryPage.url($$createDefaultCategory.custom_attributes[url_key]$$)}}?p=2" stepKey="goToPaginatedPageDisabled"/>
        <waitForPageLoad stepKey="waitForPageLoadDisabled"/>

        <!-- Verify meta robots tag contains INDEX when disabled -->
        <actionGroup ref="StorefrontAssertMetaRobotsActionGroup" stepKey="verifyMetaRobotsIndexDisabled">
            <argument name="expectedRobots" value="index"/>
        </actionGroup>

        <!-- Verify meta robots tag contains FOLLOW when disabled -->
        <actionGroup ref="StorefrontAssertMetaRobotsActionGroup" stepKey="verifyMetaRobotsFollowDisabled">
            <argument name="expectedRobots" value="follow"/>
        </actionGroup>

        <!-- ============================================== -->
        <!-- TEST 5: Verify page 1 does NOT have paginated robots -->
        <!-- ============================================== -->

        <!-- Re-enable Paginated Robots for this test -->
        <actionGroup ref="AdminNavigateToSeoRobotsConfigActionGroup" stepKey="navigateToConfigTest5"/>
        <actionGroup ref="AdminExpandSeoRobotsSectionActionGroup" stepKey="expandSectionTest5"/>
        <actionGroup ref="AdminSetPaginatedRobotsActionGroup" stepKey="enablePaginatedRobotsTest5">
            <argument name="enabled" value="1"/>
        </actionGroup>
        <actionGroup ref="AdminConfigurationSetDirectiveActionGroup" stepKey="setAllOnly5">
            <argument name="rowId" value="{{AdminSeoRobotsConfigSection.paginatedRobotsTypeRow}}"/>
            <argument name="directive" value="all"/>
        </actionGroup>
        <actionGroup ref="AdminSaveSeoRobotsConfigActionGroup" stepKey="saveConfigTest5"/>
        <actionGroup ref="CliCacheFlushActionGroup" stepKey="flushCacheTest5">
            <argument name="tags" value=""/>
        </actionGroup>

        <!-- Navigate to page 1 (no pagination) -->
        <amOnPage url="{{StorefrontCategoryPage.url($$createDefaultCategory.custom_attributes[url_key]$$)}}" stepKey="goToFirstPage"/>
        <waitForPageLoad stepKey="waitForFirstPageLoad"/>

        <!-- Verify page 1 has INDEX,FOLLOW (not affected by pagination setting) -->
        <actionGroup ref="StorefrontAssertMetaRobotsActionGroup" stepKey="verifyFirstPageIndex">
            <argument name="expectedRobots" value="index"/>
        </actionGroup>

        <actionGroup ref="StorefrontAssertMetaRobotsActionGroup" stepKey="verifyFirstPageFollow">
            <argument name="expectedRobots" value="follow"/>
        </actionGroup>
    </test>
</tests>
